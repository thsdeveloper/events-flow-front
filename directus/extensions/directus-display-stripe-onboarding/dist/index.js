import{defineComponent as e,ref as a,onMounted as n,resolveComponent as t,createElementBlock as r,openBlock as o,createVNode as i,withCtx as d,createTextVNode as s,toDisplayString as c,createCommentVNode as l,createElementVNode as u,createBlock as p}from"vue";import{useApi as g,defineDisplay as b}from"@directus/extensions-sdk";var v=e({props:{value:{type:String,required:!0}},setup(e){const t=g(),r=a(!0),o=a(!1),i=a(null),d=a(null);return n(()=>{(async()=>{try{r.value=!0,i.value=null;const a=await t.get(`/items/organizers/${e.value}`,{params:{fields:["id","stripe_account_id","stripe_onboarding_complete","stripe_charges_enabled","stripe_payouts_enabled"]}});d.value=a.data.data}catch(e){i.value=e.message||"Erro ao carregar dados do organizador",console.error("Error fetching organizer:",e)}finally{r.value=!1}})()}),{loading:r,creating:o,error:i,organizerData:d,createOnboardingLink:async()=>{try{o.value=!0,i.value=null;const a=await t.post("/stripe/connect-onboarding",{organizer_id:e.value});if(!a.data.url)throw new Error("URL não retornada pelo servidor");window.open(a.data.url,"_blank"),alert("Link de cadastro gerado! Uma nova janela foi aberta com o formulário do Stripe.")}catch(e){i.value=e.response?.data?.message||e.message||"Erro ao criar link de onboarding",console.error("Error creating onboarding link:",e),alert(`Erro: ${i.value}`)}finally{o.value=!1}}}}}),_=[],f=[];!function(e,a){if(e&&"undefined"!=typeof document){var n,t=!0===a.prepend?"prepend":"append",r=!0===a.singleTag,o="string"==typeof a.container?document.querySelector(a.container):document.getElementsByTagName("head")[0];if(r){var i=_.indexOf(o);-1===i&&(i=_.push(o)-1,f[i]={}),n=f[i]&&f[i][t]?f[i][t]:f[i][t]=d()}else n=d();65279===e.charCodeAt(0)&&(e=e.substring(1)),n.styleSheet?n.styleSheet.cssText+=e:n.appendChild(document.createTextNode(e))}function d(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),a.attributes)for(var n=Object.keys(a.attributes),r=0;r<n.length;r++)e.setAttribute(n[r],a.attributes[n[r]]);var i="prepend"===t?"afterbegin":"beforeend";return o.insertAdjacentElement(i,e),e}}("\n.stripe-onboarding-display[data-v-9adb6461] {\n\tpadding: 12px;\n\tborder: 1px solid var(--theme--border-color-subdued);\n\tborder-radius: var(--theme--border-radius);\n\tbackground-color: var(--theme--background-subdued);\n}\n.loading[data-v-9adb6461] {\n\tdisplay: flex;\n\tjustify-content: center;\n\tpadding: 20px;\n}\n.status-container[data-v-9adb6461] {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 12px;\n}\n.status-badges[data-v-9adb6461] {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tgap: 8px;\n}\n.action-button[data-v-9adb6461] {\n\tdisplay: flex;\n\tgap: 8px;\n}\n.account-id[data-v-9adb6461] {\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 12px;\n}\n.error[data-v-9adb6461] {\n\tpadding: 8px 0;\n}\n",{});const m={class:"stripe-onboarding-display"},y={key:0,class:"loading"},k={key:1,class:"error"},h={key:2,class:"status-container"},x={class:"status-badges"},z={class:"action-button"},C={key:0,class:"account-id"};var D=b({id:"stripe-onboarding",name:"Stripe Onboarding Status",description:"Shows Stripe Connect onboarding status and action button",icon:"credit_card",component:((e,a)=>{const n=e.__vccOpts||e;for(const[e,t]of a)n[e]=t;return n})(v,[["render",function(e,a,n,g,b,v){const _=t("v-spinner"),f=t("v-notice"),D=t("v-badge"),S=t("v-button");return o(),r("div",m,[e.loading?(o(),r("div",y,[i(_)])):e.error?(o(),r("div",k,[i(f,{type:"danger"},{default:d(()=>[s(c(e.error),1)]),_:1})])):(o(),r("div",h,[l(" Status Badges "),u("div",x,[i(D,{color:e.organizerData?.stripe_onboarding_complete?"success":"warning",icon:e.organizerData?.stripe_onboarding_complete?"check_circle":"pending"},{default:d(()=>[s(c(e.organizerData?.stripe_onboarding_complete?"Cadastro Completo":"Cadastro Pendente"),1)]),_:1},8,["color","icon"]),e.organizerData?.stripe_charges_enabled?(o(),p(D,{key:0,color:"success",icon:"payments"},{default:d(()=>a[0]||(a[0]=[s(" Pagamentos Habilitados ",-1)])),_:1,__:[0]})):l("v-if",!0),e.organizerData?.stripe_payouts_enabled?(o(),p(D,{key:1,color:"success",icon:"account_balance"},{default:d(()=>a[1]||(a[1]=[s(" Transferências Habilitadas ",-1)])),_:1,__:[1]})):l("v-if",!0)]),l(" Action Button "),u("div",z,[e.organizerData?.stripe_onboarding_complete?e.organizerData?.stripe_account_id?(o(),p(S,{key:1,loading:e.creating,onClick:e.createOnboardingLink,icon:"refresh",secondary:""},{default:d(()=>a[3]||(a[3]=[s(" Atualizar Cadastro ",-1)])),_:1,__:[3]},8,["loading","onClick"])):l("v-if",!0):(o(),p(S,{key:0,loading:e.creating,onClick:e.createOnboardingLink,icon:"settings"},{default:d(()=>a[2]||(a[2]=[s(" Configurar Pagamentos ",-1)])),_:1,__:[2]},8,["loading","onClick"]))]),l(" Account ID "),e.organizerData?.stripe_account_id?(o(),r("div",C,[u("small",null,"Stripe Account ID: "+c(e.organizerData.stripe_account_id),1)])):l("v-if",!0)]))])}],["__scopeId","data-v-9adb6461"]]),options:null,types:["uuid","string"]});export{D as default};
