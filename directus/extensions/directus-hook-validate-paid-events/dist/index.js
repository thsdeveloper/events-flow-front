"use strict";module.exports=({filter:e,action:a},{services:r,getSchema:t,logger:i})=>{const{ItemsService:o}=r;e("events.items.create",async(e,a,r)=>{if(!e.requires_payment)return e;const n=await t(),s=new o("organizers",{schema:n,accountability:r.accountability});try{const a=await s.readOne(e.organizer_id);if(!a.stripe_onboarding_complete)throw i.warn("Attempted to create paid event with incomplete Stripe onboarding",{organizer_id:e.organizer_id,event_title:e.title}),new Error('Este organizador ainda não completou o cadastro de pagamentos no Stripe. Acesse o painel do organizador e clique em "Configurar Pagamentos" para completar o cadastro.');if(!a.stripe_charges_enabled)throw i.warn("Attempted to create paid event with charges disabled",{organizer_id:e.organizer_id,event_title:e.title}),new Error("Este organizador não está habilitado para receber pagamentos. Verifique o status da conta Stripe no painel do organizador.");return i.info("Paid event validation passed",{organizer_id:e.organizer_id,event_title:e.title}),e}catch(e){if(e.message.includes("Stripe")||e.message.includes("pagamentos"))throw e;throw i.error("Error validating paid event",e),new Error("Erro ao validar organizador para evento pago. Verifique se o organizador existe.")}}),e("events.items.update",async(e,a,r)=>{if(!0!==e.requires_payment)return e;const n=await t(),s=new o("events",{schema:n,accountability:r.accountability});try{const t=await s.readOne(a.keys[0]),d=e.organizer_id||t.organizer_id,c=new o("organizers",{schema:n,accountability:r.accountability}),g=await c.readOne(d);if(!g.stripe_onboarding_complete)throw new Error('Este organizador ainda não completou o cadastro de pagamentos no Stripe. Acesse o painel do organizador e clique em "Configurar Pagamentos" para completar o cadastro.');if(!g.stripe_charges_enabled)throw new Error("Este organizador não está habilitado para receber pagamentos. Verifique o status da conta Stripe no painel do organizador.");return i.info("Paid event update validation passed",{organizer_id:d,event_id:a.keys[0]}),e}catch(e){if(e.message.includes("Stripe")||e.message.includes("pagamentos"))throw e;throw i.error("Error validating paid event update",e),new Error("Erro ao validar organizador para evento pago.")}})};
